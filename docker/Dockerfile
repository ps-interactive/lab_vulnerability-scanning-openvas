FROM debian:bullseye

RUN apt update && apt install -y \
    locate \
    openssh-server \
    snmp \
    sudo

RUN mkdir /run/sshd

RUN echo 'root:PASSWORD' | chpasswd
RUN sed 's@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd
RUN grep -q "^PermitRoot" /etc/ssh/sshd_config || echo "PermitRootLogin yes" >> /etc/ssh/sshd_config
RUN grep -q "^MaxAuthTries" /etc/ssh/sshd_config || echo "MaxAuthTries 6" >> /etc/ssh/sshd_config
RUN grep -q "^MaxSessions" /etc/ssh/sshd_config || echo "MaxSessions 10" >> /etc/ssh/sshd_config
RUN RUNLEVEL=1 systemctl enable ssh
RUN ssh-keygen -A -v


EXPOSE 22
EXPOSE 161/udp

CMD ["/usr/sbin/sshd", "-D"]
